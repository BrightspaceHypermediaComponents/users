<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">
		<title>d2l-profile-image test</title>
		<script src="../../webcomponentsjs/webcomponents-lite.js"></script>
		<script src="../../web-component-tester/browser.js"></script>
		<link rel="import" href="../d2l-profile-image.html">
	</head>
	<body>
		<test-fixture id="d2l-profile-image-fixture-default">
			<template>
				<d2l-profile-image></d2l-profile-image>
			</template>
		</test-fixture>
		<test-fixture id="d2l-profile-image-fixture-small">
			<template>
				<d2l-profile-image small></d2l-profile-image>
			</template>
		</test-fixture>
		<test-fixture id="d2l-profile-image-fixture-medium">
			<template>
				<d2l-profile-image medium></d2l-profile-image>
			</template>
		</test-fixture>
		<test-fixture id="d2l-profile-image-fixture-large">
			<template>
				<d2l-profile-image large></d2l-profile-image>
			</template>
		</test-fixture>
		<test-fixture id="d2l-profile-image-fixture-x-large">
			<template>
				<d2l-profile-image x-large></d2l-profile-image>
			</template>
		</test-fixture>
		<script>
			suite('d2l-profile-image', function() {

				var sizes = ['small', 'medium', 'large', 'x-large'];
				var elements = {};
				var defaultElement;

				setup(function() {
					defaultElement = fixture('d2l-profile-image-fixture-default');
					sizes.forEach(function(size) {
						elements[size] = fixture('d2l-profile-image-fixture-' + size);
					});
				});

				// Specification can be found at
				// http://design.d2l/components/profile-images/
				[
					{ size:'small', expectedLength: 30 },
					{ size:'medium', expectedLength: 42 },
					{ size:'large', expectedLength: 60 },
					{ size:'x-large', expectedLength: 84 },
				].forEach(function(testCase) {
					test(testCase.size + ' profile image is sized according to spec', function() {
						var element = elements[testCase.size];
						assert.equal(element.offsetWidth, testCase.expectedLength);
						assert.equal(element.offsetHeight, testCase.expectedLength);
					});
				});

				[
					{ firstName:'first', lastName: 'last', failedToLoadImage: false, expectedInitials: 'FL', colourId: 10, valid: true },
					{ firstName:'First', lastName: 'Last', failedToLoadImage: false, expectedInitials: 'FL', colourId: 10, valid: true },
					{ firstName: undefined, lastName: 'last', failedToLoadImage: false, expectedInitials: '', colourId: 10, valid: false },
					{ firstName: 'first', lastName: undefined, failedToLoadImage: false, expectedInitials: 'F', colourId: 1, valid: true },
					{ firstName: undefined, lastName: undefined, failedToLoadImage: false, expectedInitials: '', colourId: 1, valid: false },
					{ firstName: null, lastName: 'last', failedToLoadImage: false, expectedInitials: '', colourId: 1, valid: false },
					{ firstName: 'first', lastName: null, failedToLoadImage: false, expectedInitials: 'F', colourId: 420, valid: true },
					{ firstName: null, lastName: null, failedToLoadImage: false, expectedInitials: '', colourId: 420, valid: false },
					{ firstName: '', lastName: 'last', failedToLoadImage: false, expectedInitials: '', colourId: 420, valid: false },
					{ firstName: 'first', lastName: '', failedToLoadImage: false, expectedInitials: 'F', colourId: 0, valid: true },
					{ firstName: '', lastName: '', failedToLoadImage: false, expectedInitials: '', userId: 0, valid: false },
					{ firstName: 'first', lastName: 'last', failedToLoadImage: false, expectedInitials: 'FL', colourId: null, valid: false },
					{ firstName: 'first', lastName: 'last', failedToLoadImage: false, expectedInitials: 'FL', colourId: -1, valid: false },
					{ firstName: 'first', lastName: 'last', failedToLoadImage: false, expectedInitials: 'FL', colourId: undefined, valid: false },

				].forEach(function(t) {
					test('_getInitials(' + t.firstName + ',' + t.lastName + ') should return ' + t.expectedInitials, function() {
						var initials = defaultElement._getInitials(t.firstName, t.lastName);
						assert.equal(initials, t.expectedInitials);
					});
					test('_showInitials(' + t.firstName + ',' + t.colourId + ',' + t.failedToLoadImage + ') should return ' + t.valid, function() {
						var initialsValid = defaultElement._showInitials(t.firstName, t.colourId, t.failedToLoadImage);
						assert.equal(initialsValid, t.valid);
					});
					test('_showShadyPerson(' + t.firstName + ',' + t.colourId + ',' + t.failedToLoadImage + ') should return ' + !t.valid, function() {
						var initialsInvalid = defaultElement._showShadyPerson(t.firstName, t.colourId, t.failedToLoadImage);
						assert.equal(initialsInvalid, !t.valid);
					});
				});

				[
					{ imageUrl:'url', failedToLoadImage: false, showAvatar: true },
					{ imageUrl:'url', failedToLoadImage: true, showAvatar: false },
					{ imageUrl:'', failedToLoadImage: true, showAvatar: false },
					{ imageUrl:'', failedToLoadImage: true, showAvatar: false }
				].forEach(function(t) {
					test('_showAvatar(' + t.imageUrl + ',' + t.failedToLoadImage + ') should return ' + t.showAvatar, function() {
						var showAvatar = defaultElement._showAvatar(t.imageUrl, t.failedToLoadImage);
						assert.equal(showAvatar, t.showAvatar);
					});
				});

				test('_getInitialedBackgroundColour consistently maps to the same colour', function() {
					var n = 50;
					var colourMapping = {};

					var i;
					for (i = 0; i < n; i++) {
						var colourFirstTime = defaultElement._getInitialedBackgroundColour(i);
						colourMapping[i] = colourFirstTime;
					}
					for (i = 0; i < n; i++) {
						var colourSecondTime = defaultElement._getInitialedBackgroundColour(i);
						assert.equal(colourSecondTime, colourMapping[i]);
					}
				});

			});
		</script>
	</body>
</html>
